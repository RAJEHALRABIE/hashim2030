<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù…ØªØ§Ø¨Ø¹ Ø­Ø§ÙØ² Ø«Ø±Ø§ÙŠÙ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 600px;
        width: 100%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 24px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .data-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .data-row:last-child {
        border-bottom: none;
      }

      .label {
        color: #666;
        font-size: 14px;
      }

      .value {
        font-weight: 600;
        color: #333;
        font-size: 16px;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 14px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        background: #6c757d;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .note {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        font-size: 13px;
        line-height: 1.6;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h1>
      <p class="subtitle">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø±Ø­Ù„Ø§ØªÙƒ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ…</p>

      <div id="alert-container"></div>

      <div class="card">
        <h3 style="margin-bottom: 15px; color: #667eea;">ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØªÙ‚Ø±ÙŠØ±Ùƒ</h3>
        <div class="data-row">
          <span class="label">ÙØªØ±Ø© Ø§Ù„Ø­Ø§ÙØ²</span>
          <span class="value">17 - 23 Ù†ÙˆÙÙ…Ø¨Ø± 2025</span>
        </div>
        <div class="data-row">
          <span class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª</span>
          <span class="value">20 Ø±Ø­Ù„Ø©</span>
        </div>
        <div class="data-row">
          <span class="label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</span>
          <span class="value">12.17 Ø³Ø§Ø¹Ø©</span>
        </div>
        <div class="data-row">
          <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„</span>
          <span class="value">382.62 Ø±.Ø³</span>
        </div>
        <div class="data-row">
          <span class="label">Ø§Ù„Ø­Ø§ÙØ² Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</span>
          <span class="value">60.00 Ø±.Ø³ (3 Ø±.Ø³ Ã— 20 Ø±Ø­Ù„Ø©)</span>
        </div>
        <div class="data-row">
          <span class="label">Ù†Ø³Ø¨Ø© ÙˆÙ‚Øª Ø§Ù„Ø°Ø±ÙˆØ©</span>
          <span class="value">61.9%</span>
        </div>
      </div>
      <div class="note">
        <strong>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong><br>
        Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ 20 Ø±Ø­Ù„Ø© Ù…Ø¹ ØªÙØ§ØµÙŠÙ„Ù‡Ø§ Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø§Ù„ØªÙˆÙ‚ÙŠØªØŒ Ø§Ù„Ù‚ÙŠÙ…Ø©ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹ØŒ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø³ØªÙ„Ù…)
        Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙŠ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©.
      </div>
      <button class="btn" onclick="importAllData()">âœ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†</button>
      <button class="btn btn-secondary" onclick="goToApp()">ğŸ  Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø©</button>
    </div>
    <script>
      // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
      const importedData = {
        trips: [
          // Ø§Ù„Ø±Ø­Ù„Ø§Øª Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
          { start: "2025-11-19T12:31:00", end: "2025-11-19T13:15:00", fare: 43.6, cashCollected: 35.00, paymentType: "cash" },
          { start: "2025-11-19T00:15:00", end: "2025-11-19T01:35:00", fare: 19.8, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T00:35:00", end: "2025-11-19T01:47:00", fare: 12.8, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T00:47:00", end: "2025-11-19T02:32:00", fare: 29.3, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T02:17:00", end: "2025-11-19T02:32:00", fare: 15.6, cashCollected: 2.50, paymentType: "mixed" },
          { start: "2025-11-19T02:32:00", end: "2025-11-19T04:32:00", fare: 119.7, cashCollected: 25.00, paymentType: "cash" },
          { start: "2025-11-19T04:32:00", end: "2025-11-19T05:48:00", fare: 75.8, cashCollected: 41.00, paymentType: "cash" },
          { start: "2025-11-19T05:48:00", end: "2025-11-19T06:37:00", fare: 48.9, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T06:37:00", end: "2025-11-19T07:13:00", fare: 36.7, cashCollected: 34.00, paymentType: "cash" },
          { start: "2025-11-19T07:14:00", end: "2025-11-19T08:19:00", fare: 65.4, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T08:40:00", end: "2025-11-19T08:40:00", fare: 0.6, cashCollected: 7.91, paymentType: "cash" },
          { start: "2025-11-19T08:40:00", end: "2025-11-19T08:47:00", fare: 7.0, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T08:47:00", end: "2025-11-19T09:18:00", fare: 30.4, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T09:18:00", end: "2025-11-19T09:36:00", fare: 17.7, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T09:36:00", end: "2025-11-19T10:59:00", fare: 61.5, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T10:37:00", end: "2025-11-19T10:59:00", fare: 21.5, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-19T10:59:00", end: "2025-11-20T12:34:00", fare: 73.7, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-20T12:12:00", end: "2025-11-20T12:34:00", fare: 21.5, cashCollected: 6.00, paymentType: "cash" },
          { start: "2025-11-20T12:34:00", end: "2025-11-20T12:53:00", fare: 18.8, cashCollected: 0, paymentType: "card" },
          { start: "2025-11-20T12:53:00", end: "2025-11-21T01:03:00", fare: 9.8, cashCollected: 0, paymentType: "card" }
        ],
        settings: {
          minHours: 25,
          minTripsBase: 35,
          peakPercentRequired: 70,
          bonusPerTrip: 3,
          acceptRate: 93,
          cancelRate: 0
        },
        weekStart: "2025-11-17T00:00:00.000Z",
        weekEnd: "2025-11-23T23:59:59.999Z"
      };

      // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø°Ø±ÙˆØ© Ø§Ù„Ù…ÙØ­Ø¯Ù‘Ø« ÙˆØ§Ù„Ù…ÙØ¯Ù…Ø¬ Ù‡Ù†Ø§
      function isPeakTime(date) {
        const d = new Date(date);
        const day = d.getDay(); // 0 = Sunday, 1 = Monday, ...
        const h = d.getHours(); // 0 - 23

        const DAYS = { SUNDAY: 0, MONDAY: 1, WEDNESDAY: 3, THURSDAY: 4, FRIDAY: 5, SATURDAY: 6 };

        // 1. Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ (0-3): 06:00 (ØµØ¨Ø§Ø­Ø§Ù‹) - 19:00 (7 Ù…Ø³Ø§Ø¡Ù‹)
        if (day >= DAYS.SUNDAY && day <= DAYS.WEDNESDAY) {
          return h >= 6 && h < 19;
        }

        // 2. Ø§Ù„Ø®Ù…ÙŠØ³ (4): 06:00 (ØµØ¨Ø§Ø­Ø§Ù‹) - 01:00 (ÙØ¬Ø± Ø§Ù„Ø¬Ù…Ø¹Ø©)
        if (day === DAYS.THURSDAY && h >= 6) {
          return true;
        }
        if (day === DAYS.FRIDAY && h < 1) {
          return true;
        }

        // 3. Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¨Øª (5 Ùˆ 6): 18:00 (6 Ù…Ø³Ø§Ø¡Ù‹) - 01:00 (ÙØ¬Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ)
        if ((day === DAYS.FRIDAY || day === DAYS.SATURDAY) && h >= 18) {
          return true;
        }
        // 4. Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ø¥Ù„Ù‰ ÙØ¬Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
        if ((day === DAYS.SATURDAY || day === DAYS.SUNDAY) && h < 1) {
          return true;
        }

        return false;
      }

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø©
      function calculateDuration(start, end) {
        const startDate = new Date(start);
        const endDate = new Date(end);
        const diffMs = endDate - startDate;
        return Math.max(1, diffMs / (1000 * 60));
      }
      
      // ğŸ“Œ Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØªÙØ§Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙØ±
      function setInitialState(state) {
        try {
            // Ù‡Ø°Ø§ ÙŠØ­Ø§ÙƒÙŠ ØªØ­Ù…ÙŠÙ„ app.js Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
            const totals = computeTotalsFromState(state);
            document.getElementById('sum-trips').textContent = totals.tripCount + ' Ø±Ø­Ù„Ø©';
            document.getElementById('sum-hours').textContent = (totals.totalHours).toFixed(2) + ' Ø³Ø§Ø¹Ø©';
            document.getElementById('sum-income').textContent = (totals.totalFare).toFixed(2) + ' Ø±.Ø³';
            
            // ... ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ù‡Ù†Ø§
        } catch (e) {
            // ØªØ¬Ø§Ù‡Ù„ Ø®Ø·Ø£ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©
        }
      }
      
      // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª (Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© Ù…Ù† app.js)
      function computeTotalsFromState(state) {
        const trips = state.trips || [];
        let totalMinutes = 0;
        let totalFare = 0;
        
        for (const t of trips) {
            totalMinutes += t.durationMinutes || 0;
            totalFare += Number(t.fare || 0);
        }
        
        return {
            totalHours: totalMinutes / 60,
            totalFare,
            tripCount: trips.length
        };
      }

      // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      function importAllData() {
        try {
          // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª ØªØ­Ø³Ø¨ isPeakTime Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„ØµØ­ÙŠØ­
          const state = {
            weekStart: importedData.weekStart,
            weekEnd: importedData.weekEnd,
            settings: importedData.settings,
            trips: importedData.trips.map((trip, index) => ({
              id: Date.now() + index,
              start: trip.start,
              end: trip.end,
              durationMinutes: calculateDuration(trip.start, trip.end),
              fare: trip.fare,
              paymentType: trip.paymentType,
              cashCollected: trip.cashCollected,
              isPeak: isPeakTime(trip.start)
            })),
            activeTripStart: null,
            peakMigratedV2: true
          };

          // Ø­ÙØ¸ ÙÙŠ localStorage
          localStorage.setItem('thrivve-tracker-v4.2-state', JSON.stringify(state));

          showAlert('âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! (20 Ø±Ø­Ù„Ø©)\nØ³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚...', 'success');
          
          // ğŸ“Œ ØªØµØ­ÙŠØ­: Ø¥Ø¶Ø§ÙØ© ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ù…Ù†Ø­ Ø§Ù„Ù…ØªØµÙØ­ ÙˆÙ‚ØªØ§Ù‹ Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­ÙØ¸
          setTimeout(() => {
            window.location.href = './index.html';
          }, 500); // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¥Ù„Ù‰ 500 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ù„Ù„ØªØ¬Ø±Ø¨Ø©

        } catch (error) {
          alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: ' + error.message);
          console.error(error);
        }
      }

      function showAlert(message, type) {
        const container = document.getElementById('alert-container');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.textContent = message;
        alert.style.whiteSpace = 'pre-line';
        container.innerHTML = '';
        container.appendChild(alert);
      }

      function goToApp() {
        window.location.href = './index.html';
      }
      
      // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ù†Ø¶Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØªØ¹ÙƒØ³ Ø§Ù„Ù€ importedData
      document.addEventListener('DOMContentLoaded', () => {
          setInitialState(importedData);
      });
    </script>
  </body>
</html>
